"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Map2D_1 = require("./Map2D");
const TemplateRoom_1 = require("./TemplateRoom");
const seedrandom = require("seedrandom");
const utils_1 = require("./utils");
let defaults = {
    width: 50,
    height: 50,
};
var ETiles;
(function (ETiles) {
    ETiles[ETiles["SOLID"] = -1] = "SOLID";
    ETiles[ETiles["EMPTY"] = 0] = "EMPTY";
    ETiles[ETiles["WALL"] = 1] = "WALL";
    ETiles[ETiles["TOP_DOOR"] = 2] = "TOP_DOOR";
    ETiles[ETiles["BOTTOM_DOOR"] = 3] = "BOTTOM_DOOR";
    ETiles[ETiles["LEFT_DOOR"] = 4] = "LEFT_DOOR";
    ETiles[ETiles["RIGHT_DOOR"] = 5] = "RIGHT_DOOR";
    ETiles[ETiles["LADDER"] = 6] = "LADDER";
})(ETiles = exports.ETiles || (exports.ETiles = {}));
function oppositeDirection(dir) {
    switch (dir) {
        case TemplateRoom_1.Direction.TOP: return TemplateRoom_1.Direction.BOTTOM;
        case TemplateRoom_1.Direction.BOTTOM: return TemplateRoom_1.Direction.TOP;
        case TemplateRoom_1.Direction.LEFT: return TemplateRoom_1.Direction.RIGHT;
        case TemplateRoom_1.Direction.RIGHT: return TemplateRoom_1.Direction.LEFT;
    }
}
const directions = [TemplateRoom_1.Direction.TOP, TemplateRoom_1.Direction.BOTTOM, TemplateRoom_1.Direction.LEFT, TemplateRoom_1.Direction.RIGHT];
function addOpenDoor(x, y, room, direction, openDoors) {
    if (room.doorways[direction] < 0)
        return;
    if (direction === TemplateRoom_1.Direction.TOP) {
        openDoors.push({ direction: direction, x: x + room.doorways[direction], y: y });
    }
    else if (direction === TemplateRoom_1.Direction.BOTTOM) {
        openDoors.push({ direction: direction, x: x + room.doorways[direction], y: y + room.height - 1 });
    }
    else if (direction === TemplateRoom_1.Direction.LEFT) {
        openDoors.push({ direction: direction, x: x, y: y + room.doorways[direction] });
    }
    else if (direction === TemplateRoom_1.Direction.RIGHT) {
        openDoors.push({ direction: direction, x: x + room.width - 1, y: y + room.doorways[direction] });
    }
}
function addOpenDoors(x, y, room, openDoors, exculde = []) {
    for (let dir of directions) {
        if (exculde.indexOf(dir) >= 0 || room.doorways[dir] < 0)
            continue;
        addOpenDoor(x, y, room, dir, openDoors);
    }
}
function roomCanAttach(direction, candidateRoom) {
    return candidateRoom.doorways[oppositeDirection(direction)] >= 0;
}
function connectedRoomXY(door, room) {
    let connectingDoor = room.doorways[oppositeDirection(door.direction)];
    switch (door.direction) {
        case TemplateRoom_1.Direction.TOP: return { x: door.x - connectingDoor, y: door.y - room.height };
        case TemplateRoom_1.Direction.BOTTOM: return { x: door.x - connectingDoor, y: door.y + 1 };
        case TemplateRoom_1.Direction.LEFT: return { x: door.x - room.width, y: door.y - connectingDoor };
        case TemplateRoom_1.Direction.RIGHT: return { x: door.x + 1, y: door.y - connectingDoor };
        default: throw new Error("Invalid direction");
    }
}
function DunGen(templates, opts) {
    opts = opts || {};
    for (let key of utils_1.Keys(defaults)) {
        if (opts[key] === undefined)
            opts[key] = defaults[key];
    }
    let prng = seedrandom(opts.seed);
    let dungeon = new Dungeon(opts.width, opts.height, opts.seed || "");
    let openDoors = [];
    templates = fyShuffle(templates, prng);
    let root = templates[0];
    let x = Math.floor((dungeon.width - root.width) / 2);
    let y = Math.floor((dungeon.height - root.height) / 2);
    if (!dungeon.paint(root, x, y)) {
        return dungeon;
    }
    addOpenDoors(x, y, root, openDoors);
    while (openDoors.length) {
        openDoors = fyShuffle(openDoors, prng);
        let door = openDoors.pop();
        templates = fyShuffle(templates, prng);
        for (let candidate of templates) {
            if (!roomCanAttach(door.direction, candidate))
                continue;
            let xy = connectedRoomXY(door, candidate);
            if (dungeon.paint(candidate, xy.x, xy.y)) {
                addOpenDoors(xy.x, xy.y, candidate, openDoors, [oppositeDirection(door.direction)]);
            }
        }
    }
    dungeon = dungeon.map((tile, x, y, dungeon) => {
        if (tile === ETiles.SOLID || tile === ETiles.WALL) {
            if (y > 0 && y < dungeon.height - 1) {
                let top = dungeon.tiles.get(x, y - 1);
                let bottom = dungeon.tiles.get(x, y + 1);
                if (((top === TemplateRoom_1.Direction.BOTTOM || top === 0) && (bottom === TemplateRoom_1.Direction.TOP || bottom === 0))
                    && top !== bottom) {
                    return TemplateRoom_1.Direction.BOTTOM;
                }
            }
            if (x > 0 && x < dungeon.width - 1) {
                let left = dungeon.tiles.get(x - 1, y);
                let right = dungeon.tiles.get(x + 1, y);
                if (((left === TemplateRoom_1.Direction.RIGHT || left === 0) && (right === TemplateRoom_1.Direction.LEFT || right === 0))
                    && left !== right) {
                    return 0;
                }
            }
        }
        if (directions.indexOf(tile) < 0)
            return tile;
        if (x > 0 && x < dungeon.width - 1 && y > 0 && y < dungeon.height - 1) {
            let xy = { x: 0, y: 0 };
            switch (tile) {
                case TemplateRoom_1.Direction.TOP:
                    xy.y = -1;
                    break;
                case TemplateRoom_1.Direction.BOTTOM:
                    xy.y = 1;
                    break;
                case TemplateRoom_1.Direction.LEFT:
                    xy.x = -1;
                    break;
                case TemplateRoom_1.Direction.RIGHT:
                    xy.x = 1;
                    break;
            }
            if (dungeon.tiles.get(x + xy.x, y + xy.y) === oppositeDirection(tile)) {
                return tile === TemplateRoom_1.Direction.BOTTOM ? TemplateRoom_1.Direction.BOTTOM : ETiles.EMPTY;
            }
            else {
                if (x > 1 && x < dungeon.width - 2 && y > 1 && y < dungeon.height - 2) {
                    let reach = dungeon.tiles.get(x + xy.x * 2, y + xy.y * 2);
                    if (reach === ETiles.EMPTY || reach === oppositeDirection(tile)) {
                        return tile === TemplateRoom_1.Direction.BOTTOM ? TemplateRoom_1.Direction.BOTTOM : ETiles.EMPTY;
                    }
                }
            }
        }
        return ETiles.WALL;
    });
    let ladderSeeds = [];
    for (let i = 0; i < dungeon.width - 1; i++) {
        for (let j = 0; j < dungeon.width - 1; j++) {
            if (dungeon.tiles.get(i, j) === ETiles.EMPTY && dungeon.tiles.get(i + 1, j) === ETiles.EMPTY) {
                let bl = dungeon.tiles.get(i, j + 1);
                let br = dungeon.tiles.get(i + 1, j + 1);
                if (bl === 1 && br === TemplateRoom_1.Direction.BOTTOM) {
                    ladderSeeds.push({ x: i + 1, y: j + 1 });
                }
                else if (bl === TemplateRoom_1.Direction.BOTTOM && br === ETiles.WALL) {
                    ladderSeeds.push({ x: i, y: j + 1 });
                }
            }
        }
    }
    ladderSeeds = fyShuffle(ladderSeeds, prng);
    function eraseBottomDoor(x, y) {
        if (dungeon.tiles.get(x, y) === TemplateRoom_1.Direction.BOTTOM) {
            dungeon.tiles.set(x, y, ETiles.EMPTY);
            eraseBottomDoor(x - 1, y);
            eraseBottomDoor(x + 1, y);
        }
    }
    while (ladderSeeds.length > 0) {
        let seed = ladderSeeds.pop();
        if (dungeon.tiles.get(seed.x, seed.y) !== TemplateRoom_1.Direction.BOTTOM)
            continue;
        while (dungeon.tiles.get(seed.x, seed.y) !== ETiles.WALL) {
            if (dungeon.tiles.get(seed.x, seed.y) === TemplateRoom_1.Direction.BOTTOM) {
                eraseBottomDoor(seed.x, seed.y);
            }
            dungeon.tiles.set(seed.x, seed.y, ETiles.LADDER);
            seed.y++;
        }
    }
    return dungeon.map((t) => t === ETiles.SOLID ? ETiles.WALL : t === ETiles.BOTTOM_DOOR ? ETiles.EMPTY : t);
}
exports.DunGen = DunGen;
class Dungeon {
    constructor(width, height, seed, initializer = () => -1) {
        this.width = width;
        this.height = height;
        this.seed = seed;
        this.tiles = new Map2D_1.Map2D();
        for (let i = 0; i < width; i++) {
            for (let j = 0; j < height; j++) {
                this.tiles.set(i, j, initializer(i, j));
            }
        }
    }
    paint(room, x, y) {
        if (x < 0 || y < 0 || x + room.width > this.width || y + room.height > this.height)
            return false;
        for (let i = 0; i < room.width; i++) {
            for (let j = 0; j < room.height; j++) {
                let tile = this.tiles.get(x + i, y + j);
                if (tile === undefined || tile !== ETiles.SOLID)
                    return false;
            }
        }
        for (let i = 0; i < room.width; i++) {
            for (let j = 0; j < room.height; j++) {
                this.tiles.set(x + i, y + j, room.tiles.get(i, j));
            }
        }
        return true;
    }
    map(fn) {
        return new Dungeon(this.width, this.height, this.seed, (x, y) => {
            return fn(this.tiles.get(x, y), x, y, this);
        });
    }
}
exports.Dungeon = Dungeon;
function fyShuffle(arr, prng) {
    arr = arr.slice();
    for (let i = arr.length - 1; i > 0; i--) {
        let swp = Math.floor(prng() * (i + 1));
        let temp = arr[i];
        arr[i] = arr[swp];
        arr[swp] = temp;
    }
    return arr;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRHVuR2VuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vY29tbW9uL0R1bkdlbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1DQUFnQztBQUNoQyxpREFBeUQ7QUFDekQseUNBQXlDO0FBQ3pDLG1DQUErQjtBQVEvQixJQUFJLFFBQVEsR0FBZTtJQUN2QixLQUFLLEVBQUUsRUFBRTtJQUNULE1BQU0sRUFBRSxFQUFFO0NBQ2IsQ0FBQTtBQVdELElBQVksTUFTWDtBQVRELFdBQVksTUFBTTtJQUNkLHNDQUFVLENBQUE7SUFDVixxQ0FBUyxDQUFBO0lBQ1QsbUNBQVEsQ0FBQTtJQUNSLDJDQUF3QixDQUFBO0lBQ3hCLGlEQUE4QixDQUFBO0lBQzlCLDZDQUEwQixDQUFBO0lBQzFCLCtDQUE0QixDQUFBO0lBQzVCLHVDQUFVLENBQUE7QUFDZCxDQUFDLEVBVFcsTUFBTSxHQUFOLGNBQU0sS0FBTixjQUFNLFFBU2pCO0FBRUQsMkJBQTJCLEdBQWM7SUFDckMsUUFBTyxHQUFHLEVBQUU7UUFDUixLQUFLLHdCQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsT0FBTyx3QkFBUyxDQUFDLE1BQU0sQ0FBQztRQUM1QyxLQUFLLHdCQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyx3QkFBUyxDQUFDLEdBQUcsQ0FBQztRQUM1QyxLQUFLLHdCQUFTLENBQUMsSUFBSSxDQUFDLENBQUMsT0FBTyx3QkFBUyxDQUFDLEtBQUssQ0FBQztRQUM1QyxLQUFLLHdCQUFTLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyx3QkFBUyxDQUFDLElBQUksQ0FBQztLQUMvQztBQUNMLENBQUM7QUFFRCxNQUFNLFVBQVUsR0FBRyxDQUFDLHdCQUFTLENBQUMsR0FBRyxFQUFFLHdCQUFTLENBQUMsTUFBTSxFQUFFLHdCQUFTLENBQUMsSUFBSSxFQUFFLHdCQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7QUFFdEYscUJBQXFCLENBQVMsRUFBRSxDQUFTLEVBQUUsSUFBa0IsRUFBRSxTQUFvQixFQUFFLFNBQXNCO0lBQ3ZHLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDO1FBQUUsT0FBTztJQUN6QyxJQUFJLFNBQVMsS0FBSyx3QkFBUyxDQUFDLEdBQUcsRUFBRTtRQUM3QixTQUFTLENBQUMsSUFBSSxDQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFFLENBQUM7S0FDckY7U0FBTSxJQUFJLFNBQVMsS0FBSyx3QkFBUyxDQUFDLE1BQU0sRUFBRTtRQUN2QyxTQUFTLENBQUMsSUFBSSxDQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsR0FBRyxJQUFJLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRSxDQUFFLENBQUM7S0FDdkc7U0FBTSxJQUFJLFNBQVMsS0FBSyx3QkFBUyxDQUFDLElBQUksRUFBRTtRQUNyQyxTQUFTLENBQUMsSUFBSSxDQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFFLENBQUM7S0FDckY7U0FBTSxJQUFJLFNBQVMsS0FBSyx3QkFBUyxDQUFDLEtBQUssRUFBRTtRQUN0QyxTQUFTLENBQUMsSUFBSSxDQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFFLENBQUM7S0FDdEc7QUFDTCxDQUFDO0FBRUQsc0JBQXNC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dEMsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZDLElBQUksSUFBSSxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNsQixHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ2xCLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxJQUFJLENBQUM7S0FDbkI7SUFDRCxPQUFPLEdBQUcsQ0FBQztBQUNmLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBNYXAyRCB9IGZyb20gXCIuL01hcDJEXCI7XHJcbmltcG9ydCB7IFRlbXBsYXRlUm9vbSwgRGlyZWN0aW9uIH0gZnJvbSBcIi4vVGVtcGxhdGVSb29tXCI7XHJcbmltcG9ydCAqIGFzIHNlZWRyYW5kb20gZnJvbSBcInNlZWRyYW5kb21cIjtcclxuaW1wb3J0IHsgS2V5cyB9IGZyb20gXCIuL3V0aWxzXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIER1bkdlbk9wdHMge1xyXG4gICAgd2lkdGg/OiBudW1iZXIsXHJcbiAgICBoZWlnaHQ/OiBudW1iZXIsXHJcbiAgICBzZWVkPzogc3RyaW5nLFxyXG59XHJcblxyXG5sZXQgZGVmYXVsdHM6IER1bkdlbk9wdHMgPSB7XHJcbiAgICB3aWR0aDogNTAsXHJcbiAgICBoZWlnaHQ6IDUwLFxyXG59XHJcblxyXG5pbnRlcmZhY2UgSU9wZW5Eb29yIGV4dGVuZHMgSVBvaW50IHtcclxuICAgIGRpcmVjdGlvbjogRGlyZWN0aW9uO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgSVBvaW50IHtcclxuICAgIHg6IG51bWJlcjtcclxuICAgIHk6IG51bWJlcjtcclxufVxyXG5cclxuZXhwb3J0IGVudW0gRVRpbGVzIHtcclxuICAgIFNPTElEID0gLTEsXHJcbiAgICBFTVBUWSA9IDAsXHJcbiAgICBXQUxMID0gMSxcclxuICAgIFRPUF9ET09SID0gRGlyZWN0aW9uLlRPUCxcclxuICAgIEJPVFRPTV9ET09SID0gRGlyZWN0aW9uLkJPVFRPTSxcclxuICAgIExFRlRfRE9PUiA9IERpcmVjdGlvbi5MRUZULFxyXG4gICAgUklHSFRfRE9PUiA9IERpcmVjdGlvbi5SSUdIVCxcclxuICAgIExBRERFUiA9IDYsXHJcbn1cclxuXHJcbmZ1bmN0aW9uIG9wcG9zaXRlRGlyZWN0aW9uKGRpcjogRGlyZWN0aW9uKTogRGlyZWN0aW9uIHtcclxuICAgIHN3aXRjaChkaXIpIHtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5UT1A6IHJldHVybiBEaXJlY3Rpb24uQk9UVE9NO1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogcmV0dXJuIERpcmVjdGlvbi5UT1A7XHJcbiAgICAgICAgY2FzZSBEaXJlY3Rpb24uTEVGVDogcmV0dXJuIERpcmVjdGlvbi5SSUdIVDtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5SSUdIVDogcmV0dXJuIERpcmVjdGlvbi5MRUZUO1xyXG4gICAgfVxyXG59XHJcblxyXG5jb25zdCBkaXJlY3Rpb25zID0gW0RpcmVjdGlvbi5UT1AsIERpcmVjdGlvbi5CT1RUT00sIERpcmVjdGlvbi5MRUZULCBEaXJlY3Rpb24uUklHSFRdO1xyXG5cclxuZnVuY3Rpb24gYWRkT3BlbkRvb3IoeDogbnVtYmVyLCB5OiBudW1iZXIsIHJvb206IFRlbXBsYXRlUm9vbSwgZGlyZWN0aW9uOiBEaXJlY3Rpb24sIG9wZW5Eb29yczogSU9wZW5Eb29yW10pIHtcclxuICAgIGlmIChyb29tLmRvb3J3YXlzW2RpcmVjdGlvbl0gPCAwKSByZXR1cm47XHJcbiAgICBpZiAoZGlyZWN0aW9uID09PSBEaXJlY3Rpb24uVE9QKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzLnB1c2goIHsgZGlyZWN0aW9uOiBkaXJlY3Rpb24sIHg6IHggKyByb29tLmRvb3J3YXlzW2RpcmVjdGlvbl0sIHk6IHkgfSApO1xyXG4gICAgfSBlbHNlIGlmIChkaXJlY3Rpb24gPT09IERpcmVjdGlvbi5CT1RUT00pIHtcclxuICAgICAgICBvcGVuRG9vcnMucHVzaCggeyBkaXJlY3Rpb246IGRpcmVjdGlvbiwgeDogeCArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSwgeTogeSArIHJvb20uaGVpZ2h0IC0gMSB9ICk7XHJcbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLkxFRlQpIHtcclxuICAgICAgICBvcGVuRG9vcnMucHVzaCggeyBkaXJlY3Rpb246IGRpcmVjdGlvbiwgeDogeCwgeTogeSArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSB9ICk7XHJcbiAgICB9IGVsc2UgaWYgKGRpcmVjdGlvbiA9PT0gRGlyZWN0aW9uLlJJR0hUKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzLnB1c2goIHsgZGlyZWN0aW9uOiBkaXJlY3Rpb24sIHg6IHggKyByb29tLndpZHRoIC0gMSwgeTogeSArIHJvb20uZG9vcndheXNbZGlyZWN0aW9uXSB9ICk7XHJcbiAgICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFkZE9wZW5Eb29ycyh4OiBudW1iZXIsIHk6IG51bWJlciwgcm9vbTogVGVtcGxhdGVSb29tLCBvcGVuRG9vcnM6IElPcGVuRG9vcltdLCBleGN1bGRlOiBEaXJlY3Rpb25bXSA9IFtdKSB7XHJcbiAgICBmb3IgKGxldCBkaXIgb2YgZGlyZWN0aW9ucykge1xyXG4gICAgICAgIGlmIChleGN1bGRlLmluZGV4T2YoZGlyKSA+PSAwIHx8IHJvb20uZG9vcndheXNbZGlyXSA8IDApIGNvbnRpbnVlO1xyXG4gICAgICAgIGFkZE9wZW5Eb29yKHgsIHksIHJvb20sIGRpciwgb3BlbkRvb3JzKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gcm9vbUNhbkF0dGFjaChkaXJlY3Rpb246IERpcmVjdGlvbiwgY2FuZGlkYXRlUm9vbTogVGVtcGxhdGVSb29tKSB7XHJcbiAgICByZXR1cm4gY2FuZGlkYXRlUm9vbS5kb29yd2F5c1tvcHBvc2l0ZURpcmVjdGlvbihkaXJlY3Rpb24pXSA+PSAwO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjb25uZWN0ZWRSb29tWFkoZG9vcjogSU9wZW5Eb29yLCByb29tOiBUZW1wbGF0ZVJvb20pIHtcclxuICAgIGxldCBjb25uZWN0aW5nRG9vciA9IHJvb20uZG9vcndheXNbb3Bwb3NpdGVEaXJlY3Rpb24oZG9vci5kaXJlY3Rpb24pXTtcclxuICAgIHN3aXRjaCAoZG9vci5kaXJlY3Rpb24pIHtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5UT1A6IHJldHVybiB7IHg6IGRvb3IueCAtIGNvbm5lY3RpbmdEb29yLCB5OiBkb29yLnkgLSByb29tLmhlaWdodCB9O1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogcmV0dXJuIHsgeDogZG9vci54IC0gY29ubmVjdGluZ0Rvb3IsIHk6IGRvb3IueSArIDEgfTtcclxuICAgICAgICBjYXNlIERpcmVjdGlvbi5MRUZUOiByZXR1cm4geyB4OiBkb29yLnggLSByb29tLndpZHRoLCB5OiBkb29yLnkgLSBjb25uZWN0aW5nRG9vciB9O1xyXG4gICAgICAgIGNhc2UgRGlyZWN0aW9uLlJJR0hUOiByZXR1cm4geyB4OiBkb29yLnggKyAxLCB5OiBkb29yLnkgLSBjb25uZWN0aW5nRG9vciB9O1xyXG4gICAgICAgIGRlZmF1bHQ6IHRocm93IG5ldyBFcnJvcihcIkludmFsaWQgZGlyZWN0aW9uXCIpO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gRHVuR2VuKHRlbXBsYXRlczogVGVtcGxhdGVSb29tW10sIG9wdHM/OiBEdW5HZW5PcHRzKSB7XHJcbiAgICBvcHRzID0gb3B0cyB8fCB7fTtcclxuICAgIGZvciAobGV0IGtleSBvZiBLZXlzKGRlZmF1bHRzKSkge1xyXG4gICAgICAgIGlmIChvcHRzW2tleV0gPT09IHVuZGVmaW5lZCkgb3B0c1trZXldID0gZGVmYXVsdHNba2V5XTtcclxuICAgIH1cclxuICAgIGxldCBwcm5nID0gc2VlZHJhbmRvbShvcHRzLnNlZWQpO1xyXG4gICAgbGV0IGR1bmdlb24gPSBuZXcgRHVuZ2VvbihvcHRzLndpZHRoISwgb3B0cy5oZWlnaHQhLCBvcHRzLnNlZWQgfHwgXCJcIik7XHJcbiAgICBsZXQgb3BlbkRvb3JzOiBJT3BlbkRvb3JbXSA9IFtdO1xyXG4gICAgdGVtcGxhdGVzID0gZnlTaHVmZmxlKHRlbXBsYXRlcywgcHJuZyk7XHJcbiAgICBsZXQgcm9vdCA9IHRlbXBsYXRlc1swXTtcclxuICAgIGxldCB4ID0gTWF0aC5mbG9vcigoZHVuZ2Vvbi53aWR0aCAtIHJvb3Qud2lkdGgpIC8gMik7XHJcbiAgICBsZXQgeSA9IE1hdGguZmxvb3IoKGR1bmdlb24uaGVpZ2h0IC0gcm9vdC5oZWlnaHQpIC8gMik7XHJcbiAgICBpZiAoIWR1bmdlb24ucGFpbnQocm9vdCwgeCwgeSkpIHtcclxuICAgICAgICByZXR1cm4gZHVuZ2VvbjtcclxuICAgIH1cclxuICAgIGFkZE9wZW5Eb29ycyh4LCB5LCByb290LCBvcGVuRG9vcnMpO1xyXG5cclxuICAgIHdoaWxlIChvcGVuRG9vcnMubGVuZ3RoKSB7XHJcbiAgICAgICAgb3BlbkRvb3JzID0gZnlTaHVmZmxlKG9wZW5Eb29ycywgcHJuZyk7XHJcbiAgICAgICAgbGV0IGRvb3IgPSBvcGVuRG9vcnMucG9wKCkhO1xyXG4gICAgICAgIHRlbXBsYXRlcyA9IGZ5U2h1ZmZsZSh0ZW1wbGF0ZXMsIHBybmcpO1xyXG4gICAgICAgIGZvciAobGV0IGNhbmRpZGF0ZSBvZiB0ZW1wbGF0ZXMpIHtcclxuICAgICAgICAgICAgaWYgKCFyb29tQ2FuQXR0YWNoKGRvb3IuZGlyZWN0aW9uLCBjYW5kaWRhdGUpKSBjb250aW51ZTtcclxuICAgICAgICAgICAgbGV0IHh5ID0gY29ubmVjdGVkUm9vbVhZKGRvb3IsIGNhbmRpZGF0ZSk7XHJcbiAgICAgICAgICAgIGlmIChkdW5nZW9uLnBhaW50KGNhbmRpZGF0ZSwgeHkueCwgeHkueSkpIHtcclxuICAgICAgICAgICAgICAgIGFkZE9wZW5Eb29ycyh4eS54LCB4eS55LCBjYW5kaWRhdGUsIG9wZW5Eb29ycywgW29wcG9zaXRlRGlyZWN0aW9uKGRvb3IuZGlyZWN0aW9uKV0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBkdW5nZW9uID0gZHVuZ2Vvbi5tYXAoICh0aWxlLCB4LCB5LCBkdW5nZW9uKSA9PiB7XHJcbiAgICAgICAgaWYgKHRpbGUgPT09IEVUaWxlcy5TT0xJRCB8fCB0aWxlID09PSBFVGlsZXMuV0FMTCkge1xyXG4gICAgICAgICAgICBpZiAoeSA+IDAgJiYgeSA8IGR1bmdlb24uaGVpZ2h0IC0gMSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHRvcCA9IGR1bmdlb24udGlsZXMuZ2V0KHgsIHkgLSAxKTtcclxuICAgICAgICAgICAgICAgIGxldCBib3R0b20gPSBkdW5nZW9uLnRpbGVzLmdldCh4LCB5ICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoKCh0b3AgPT09IERpcmVjdGlvbi5CT1RUT00gfHwgdG9wID09PSAwKSAmJiAoYm90dG9tID09PSBEaXJlY3Rpb24uVE9QIHx8IGJvdHRvbSA9PT0gMCkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiB0b3AgIT09IGJvdHRvbSlcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gRGlyZWN0aW9uLkJPVFRPTTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeCA+IDAgJiYgeCA8IGR1bmdlb24ud2lkdGggLSAxKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGVmdCA9IGR1bmdlb24udGlsZXMuZ2V0KHggLSAxLCB5KTtcclxuICAgICAgICAgICAgICAgIGxldCByaWdodCA9IGR1bmdlb24udGlsZXMuZ2V0KHggKyAxLCB5KTtcclxuICAgICAgICAgICAgICAgIGlmICgoKGxlZnQgPT09IERpcmVjdGlvbi5SSUdIVCB8fCBsZWZ0ID09PSAwKSAmJiAocmlnaHQgPT09IERpcmVjdGlvbi5MRUZUIHx8IHJpZ2h0ID09PSAwKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAmJiBsZWZ0ICE9PSByaWdodClcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGlyZWN0aW9ucy5pbmRleE9mKHRpbGUpIDwgMCkgcmV0dXJuIHRpbGU7XHJcbiAgICAgICAgaWYgKHggPiAwICYmIHggPCBkdW5nZW9uLndpZHRoIC0gMSAmJiB5ID4gMCAmJiB5IDwgZHVuZ2Vvbi5oZWlnaHQgLSAxKSB7XHJcbiAgICAgICAgICAgIGxldCB4eSA9IHsgeDogMCwgeTogMCB9O1xyXG4gICAgICAgICAgICBzd2l0Y2ggKHRpbGUpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLlRPUDogeHkueSA9IC0xOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLkJPVFRPTTogeHkueSA9IDE7IGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBEaXJlY3Rpb24uTEVGVDogeHkueCA9IC0xOyBicmVhaztcclxuICAgICAgICAgICAgICAgIGNhc2UgRGlyZWN0aW9uLlJJR0hUOiB4eS54ID0gMTsgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHggKyB4eS54LCB5ICsgeHkueSkgPT09IG9wcG9zaXRlRGlyZWN0aW9uKHRpbGUpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGlsZSA9PT0gRGlyZWN0aW9uLkJPVFRPTSA/IERpcmVjdGlvbi5CT1RUT00gOiBFVGlsZXMuRU1QVFk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoeCA+IDEgJiYgeCA8IGR1bmdlb24ud2lkdGggLSAyICYmIHkgPiAxICYmIHkgPCBkdW5nZW9uLmhlaWdodCAtIDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmVhY2ggPSBkdW5nZW9uLnRpbGVzLmdldCh4ICsgeHkueCAqIDIsIHkgKyB4eS55ICogMilcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmVhY2ggPT09IEVUaWxlcy5FTVBUWSB8fCByZWFjaCA9PT0gb3Bwb3NpdGVEaXJlY3Rpb24odGlsZSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRpbGUgPT09IERpcmVjdGlvbi5CT1RUT00gPyBEaXJlY3Rpb24uQk9UVE9NIDogRVRpbGVzLkVNUFRZO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gRVRpbGVzLldBTEw7XHJcbiAgICB9ICk7XHJcblxyXG4gICAgbGV0IGxhZGRlclNlZWRzOiBJUG9pbnRbXSA9IFtdO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkdW5nZW9uLndpZHRoIC0gMTsgaSArKykge1xyXG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgZHVuZ2Vvbi53aWR0aCAtIDE7IGogKyspIHtcclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KGksIGopID09PSBFVGlsZXMuRU1QVFkgJiYgZHVuZ2Vvbi50aWxlcy5nZXQoaSArIDEsIGopID09PSBFVGlsZXMuRU1QVFkpIHtcclxuICAgICAgICAgICAgICAgIGxldCBibCA9IGR1bmdlb24udGlsZXMuZ2V0KGksIGogKyAxKTtcclxuICAgICAgICAgICAgICAgIGxldCBiciA9IGR1bmdlb24udGlsZXMuZ2V0KGkgKyAxLCBqICsgMSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoYmwgPT09IDEgJiYgYnIgPT09IERpcmVjdGlvbi5CT1RUT00pIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWRkZXJTZWVkcy5wdXNoKHsgeDogaSArIDEsIHk6IGogKyAxIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChibCA9PT0gRGlyZWN0aW9uLkJPVFRPTSAmJiBiciA9PT0gRVRpbGVzLldBTEwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsYWRkZXJTZWVkcy5wdXNoKHsgeDogaSwgeTogaiArIDEgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBsYWRkZXJTZWVkcyA9IGZ5U2h1ZmZsZShsYWRkZXJTZWVkcywgcHJuZyk7XHJcblxyXG4gICAgZnVuY3Rpb24gZXJhc2VCb3R0b21Eb29yKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XHJcbiAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHgsIHkpID09PSBEaXJlY3Rpb24uQk9UVE9NKSB7XHJcbiAgICAgICAgICAgIGR1bmdlb24udGlsZXMuc2V0KHgsIHksIEVUaWxlcy5FTVBUWSk7XHJcbiAgICAgICAgICAgIGVyYXNlQm90dG9tRG9vcih4IC0gMSwgeSk7XHJcbiAgICAgICAgICAgIGVyYXNlQm90dG9tRG9vcih4ICsgMSwgeSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHdoaWxlIChsYWRkZXJTZWVkcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgbGV0IHNlZWQgPSBsYWRkZXJTZWVkcy5wb3AoKSE7XHJcbiAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSAhPT0gRGlyZWN0aW9uLkJPVFRPTSkgY29udGludWU7XHJcbiAgICAgICAgd2hpbGUgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSAhPT0gRVRpbGVzLldBTEwpIHtcclxuICAgICAgICAgICAgaWYgKGR1bmdlb24udGlsZXMuZ2V0KHNlZWQueCwgc2VlZC55KSA9PT0gRGlyZWN0aW9uLkJPVFRPTSkge1xyXG4gICAgICAgICAgICAgICAgZXJhc2VCb3R0b21Eb29yKHNlZWQueCwgc2VlZC55KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBkdW5nZW9uLnRpbGVzLnNldChzZWVkLngsIHNlZWQueSwgRVRpbGVzLkxBRERFUik7XHJcbiAgICAgICAgICAgIHNlZWQueSArKztcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIGR1bmdlb24ubWFwKCAodCkgPT4gdCA9PT0gRVRpbGVzLlNPTElEID8gRVRpbGVzLldBTEwgOiB0ID09PSBFVGlsZXMuQk9UVE9NX0RPT1IgPyBFVGlsZXMuRU1QVFkgOiB0KTtcclxufVxyXG5cclxuZXhwb3J0IGNsYXNzIER1bmdlb24ge1xyXG4gICAgcHVibGljIHRpbGVzID0gbmV3IE1hcDJEPG51bWJlcj4oKTtcclxuICAgIGNvbnN0cnVjdG9yKHB1YmxpYyB3aWR0aDogbnVtYmVyLCBwdWJsaWMgaGVpZ2h0OiBudW1iZXIsIHB1YmxpYyBzZWVkOiBzdHJpbmcsIGluaXRpYWxpemVyOiAoeDogbnVtYmVyLCB5OiBudW1iZXIpID0+IG51bWJlciA9ICgpID0+IC0xKSB7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3aWR0aDsgaSArKykge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGhlaWdodDsgaiArKykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aWxlcy5zZXQoaSwgaiwgaW5pdGlhbGl6ZXIoaSwgaikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHBhaW50KHJvb206IFRlbXBsYXRlUm9vbSwgeDogbnVtYmVyLCB5OiBudW1iZXIpOiBib29sZWFuIHtcclxuICAgICAgICBpZiAoeCA8IDAgfHwgeSA8IDAgfHwgeCArIHJvb20ud2lkdGggPiB0aGlzLndpZHRoIHx8IHkgKyByb29tLmhlaWdodCA+IHRoaXMuaGVpZ2h0KSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb29tLndpZHRoOyBpICsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcm9vbS5oZWlnaHQ7IGogKyspIHtcclxuICAgICAgICAgICAgICAgIGxldCB0aWxlID0gdGhpcy50aWxlcy5nZXQoeCArIGksIHkgKyBqKTtcclxuICAgICAgICAgICAgICAgIGlmICh0aWxlID09PSB1bmRlZmluZWQgfHwgdGlsZSAhPT0gRVRpbGVzLlNPTElEKSByZXR1cm4gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByb29tLndpZHRoOyBpICsrKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcm9vbS5oZWlnaHQ7IGogKyspIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGlsZXMuc2V0KHggKyBpLCB5ICsgaiwgcm9vbS50aWxlcy5nZXQoaSwgaikpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIG1hcChmbjogKHRpbGU6IG51bWJlciwgeDogbnVtYmVyLCB5OiBudW1iZXIsIGR1bmdlb246IHRoaXMpID0+IG51bWJlcik6IER1bmdlb24ge1xyXG4gICAgICAgIHJldHVybiBuZXcgRHVuZ2Vvbih0aGlzLndpZHRoLCB0aGlzLmhlaWdodCwgdGhpcy5zZWVkLCAoeCwgeSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gZm4odGhpcy50aWxlcy5nZXQoeCwgeSksIHgsIHksIHRoaXMpO1xyXG4gICAgICAgIH0gKTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZnlTaHVmZmxlPFQ+KGFycjogVFtdLCBwcm5nOiBzZWVkcmFuZG9tLnBybmcpOiBUW10ge1xyXG4gICAgYXJyID0gYXJyLnNsaWNlKCk7XHJcbiAgICBmb3IgKGxldCBpID0gYXJyLmxlbmd0aCAtIDE7IGkgPiAwOyBpIC0tKSB7XHJcbiAgICAgICAgbGV0IHN3cCA9IE1hdGguZmxvb3IocHJuZygpICogKGkgKyAxKSk7XHJcbiAgICAgICAgbGV0IHRlbXAgPSBhcnJbaV07XHJcbiAgICAgICAgYXJyW2ldID0gYXJyW3N3cF07XHJcbiAgICAgICAgYXJyW3N3cF0gPSB0ZW1wO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGFycjtcclxufSJdfQ==